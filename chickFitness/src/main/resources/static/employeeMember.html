<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.101.0">
  <title>會員管理系統</title>

  <!-- 引入 jQuery 库 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- 引入 Bootstrap 核心 CSS 和 JavaScript -->
  <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>

  <!-- 自定義樣式 -->
  <link href="css/coursesManager.css" rel="stylesheet">
  
</head>
<body>
    
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3 text-center" href="#">GuGU Fitness</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  
  <ul class="navbar-nav px-3">
    <li class="nav-item text-nowrap">
      <a class="nav-link" href="#">Sign out</a>
    </li>
  </ul>
</nav>


<main role="main" class="col-md-9 mx-auto col-lg-10 px-md-4">
  <div class="d-flex flex-column justify-content-center align-items-center pt-3 pb-2 mb-3 border-bottom">
    <img class="mb-4" src="img/chick.png" alt="" width="295">
    <div class="btn-toolbar mb-2 mb-md-0">
      
      </div>
    
      </button>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center">
    <h3>會員管理系統</h3>
    <div>
      <button type="button" class="btn btn-secondary mx-1" data-toggle="modal" data-target="#addCourseModal">修改</button>
     <button type="button" class="btn btn-secondary mx-2 deleteButton" data-toggle="modal" data-target="#deleteMemberModal">刪除</button>

     

    </div>
  </div>
  
  <!-- 修改會員 -->
  <div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addCourseModalLabel">修改會員</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
       <div class="modal-body">
  <div class="form-group row">
    <label for="memberIdInput" class="col-sm-4 col-form-label">會員ID</label>
    <div class="col-sm-6">
      <input type="text" id="IdInput" class="form-control" placeholder="會員ID">
    </div>
    <div class="col-sm-2">
      <button type="button" class="btn btn-primary" id="searchMemberButton">查詢</button>
    </div>
  </div>
           <div class="form-group">
    <label for="memberIdInput">會員ID</label>
    <input type="text" id="memberIdInput" name="memberId" class="form-control" placeholder="會員ID">
</div>

<div class="form-group">
    <label for="NameInput">會員姓名</label>
    <input type="text" id="NameInput" name="name" class="form-control" placeholder="會員姓名">
</div>

<div class="form-group">
    <label for="userNameInput">會員帳號</label>
    <input type="text" id="userNameInput" name="userName" class="form-control" placeholder="會員帳號">
</div>

<div class="form-group">
    <label for="passwordInput">會員密碼</label>
    <input type="text" id="passwordInput" name="password" class="form-control" placeholder="會員密碼">
</div>

<div class="form-group">
    <label for="emailInput">會員信箱</label>
    <input type="text" id="emailInput" name="email" class="form-control" placeholder="會員信箱">
</div>

         
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="saveCourseButton">儲存</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 刪除會員 -->
  <div class="modal fade" id="deleteMemberModal" tabindex="-1" aria-labelledby="deleteMemberModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteMemberModalLabel">刪除會員</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
   
      <div class="modal-body">
        <div class="form-group">
          <label for="deleteMemberIdInput">要刪除的會員ID</label>
          <input type="text" id="deleteMemberIdInput" class="form-control" placeholder="會員ID">
        </div>
        <p class="text-danger">請輸入正確的會員ID，刪除後無法復原。</p>
      </div>
   
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-danger" id="deleteConfirmButton">刪除</button>
      </div>
    </div>
  </div>
</div>


  
  

  <!-- 動態生成的會員資料表格 -->
  <div id="coursesTable"></div>

  <table class="table">
    <div class="table-responsive">
      <table class="table table-striped table-sm">
        <thead>
          <tr>
            <th class="text-center">會員ID</th>
            <th class="text-center">會員姓名</th>
            <th class="text-center">會員帳號</th>
            <th class="text-center">會員密碼</th>
            <th class="text-center">會員信箱</th>
         
          </tr>
        </thead>
        <tbody id="courseTableBody">
          
        </tbody>
      </table>
    </div>
  </table>
</main>

<script>
$(document).ready(function() {
    // 擷取所有會員資料並填充表格
    $.get('/members', function(data) {
      var tableBody = $('#courseTableBody');
      tableBody.empty(); // 清空現有的行

      // 遍歷每個會員對象，為每個會員附加一行到表格中
      for (var i = 0; i < data.length; i++) {
        var member = data[i];
        var row = '<tr>' +
                  '<td class="align-middle text-center">' + member.memberId + '</td>' +
                  '<td class="align-middle text-center">' + member.name + '</td>' +
                  '<td class="align-middle text-center">' + member.userName + '</td>' +
                  '<td class="align-middle text-center">' + member.password + '</td>' +
                  '<td class="align-middle text-center">' + member.email + '</td>' +
                  '</tr>';
        tableBody.append(row);
      }
    });
  });
  ////////////////修改按鈕下的查詢按鈕/////////////////////////
// 宣告全局變數 memberId
var memberId;

// 綁定查詢按鈕的點擊事件
$('#searchMemberButton').click(function() {
	console.log('Save button clicked');
	console.log(memberId);
	 // 獲取會員ID的值
    memberId = $('#IdInput').val();

    // 使用AJAX發送GET請求到後端以查詢會員資料
    $.get('/members/' + memberId, function(member) {
        // 檢查是否找到了會員
        if (member) {
            // 填充其他欄位
            $('#memberIdInput').val(member.memberId);
            $('#NameInput').val(member.name);
            $('#userNameInput').val(member.userName);
            $('#passwordInput').val(member.password);
            $('#emailInput').val(member.email);

            // 在此處設置 memberId，以確保它是最新的
            memberId = member.memberId;
        } else {
            // 如果未找到會員，您可以顯示一個錯誤訊息
            alert('找不到該會員');
        }
    });
});

//綁定保存按鈕的點擊事件
$('#saveCourseButton').click(function() {
    var updatedMember = {
        memberId: memberId, // 使用之前獲取的 memberId
        name: $('#NameInput').val(),
        userName: $('#userNameInput').val(),
        password: $('#passwordInput').val(),
        email: $('#emailInput').val()
    };

    $.ajax({
        url: '/update',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(updatedMember),
        success: function(response) {
            if (response) {
                alert('會員資料已成功更新');
                $('#memberIdInput').val('');
                $('#NameInput').val('');
                $('#userNameInput').val('');
                $('#passwordInput').val('');
                $('#emailInput').val('');
                $('#addCourseModal').modal('hide');
                // 重新加载当前页面
                window.location.reload();
            } else {
                alert('儲存失敗');
            }
        },
        error: function() {
            alert('儲存失敗');
        }
    });
});

///////刪除/////////////////////////////////
// 綁定删除按钮的点击事件
$('#deleteConfirmButton').click(function() {
    var deleteMemberId = $('#deleteMemberIdInput').val();

    $.ajax({
        url: '/delete/' + deleteMemberId,
        type: 'DELETE',
        success: function(response) {
            if (response) {
                alert('會員已成功刪除');
                $('#deleteMemberIdInput').val('');
                $('#deleteMemberModal').modal('hide');
                // 重新加载employeeMember.html
                window.location.reload();
            } else {
                alert('刪除失敗');
            }
        },
        error: function(xhr, status, error) {
            console.error("请求失敗：", xhr.responseText);
            alert('刪除请求失敗，查看控制台獲取更多信息');
        }
    });
});



</script>

</body>
</html>
